<?php

if ( ! defined( 'ABSPATH' ) ) exit; // Exit if accessed directly

$dir = dirname(__FILE__);
require_once( "$dir/ccg_capabilities.php" );
require_once( "$dir/ccg_dashboard.php" );
require_once( "$dir/ccg_unload.php" );

global $ccg_group_role, $ccg_user_roles;

add_filter( 'user_has_cap', array( 'CCG_Capabilities', 'ccg_filter' ), 100, 3 );
add_action( 'admin_menu', array( 'CCG_Dashboard', 'menus' ) );
add_action( 'blog_privacy_selector', array( 'CCG_Dashboard', 'add_privacy_options' ) );
add_action( 'wpmu_new_blog', 'ccg_activate' );
add_action( 'delete_blog', array( 'CCG_Unload', 'ccg_delete_blog' ) );
add_action( 'add_meta_boxes', array( 'CCG_Dashboard', 'colbygroups_add_meta_box' ) );
add_action( 'save_post', array( 'CCG_Dashboard', 'colbygroups_save_meta_box_data' ) );
add_action( 'template_redirect', array( 'CCG_Capabilities', 'ccg_access_check' ) );

/* limit abilities of editors */
add_action( 'admin_head', array( 'CCG_Capabilities', 'prevent_editor_frontpage' ) );

/* modify the "Publish" meta box */
add_action( 'post_submitbox_misc_actions', array( 'CCG_Dashboard', 'colbygroups_publish_metabox' ) );

/* modify the toolbar based on the user's group capabilities */
add_action( 'admin_bar_menu', array( 'CCG_Dashboard', 'colbygroups_toolbar_mods' ), 50 );
add_filter( 'get_blogs_of_user', array( 'CCG_Dashboard', 'colbygroups_add_group_blogs' ) );

/* Removed "Private: " from the page title */
add_action( 'the_title', array( 'CCG_Dashboard', 'colbygroups_remove_private' ) );

/* allows private posts to be parents of other posts */
add_filter( 'wp_dropdown_pages', array( 'CCG_Dashboard', 'colbygroups_private_parent_metabox' ) );

/* handle 404 errors */
add_filter( '404_template', array( 'CCG_Capabilities', 'ccg_404_template' ), 2000, 1 );

/* THE LINE BELOW IS THE PLUGIN UNINSTALL HOOK, NOT IMPLEMENTED IN CODE 		*/
/* register_uninstall_hook(    __FILE__, array( 'CCG_Unload', uninstall' ) ); 	*/
